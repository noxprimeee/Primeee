<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel - Primeee Host</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #1a1a2e;
            --light: #ecf0f1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--dark);
            color: var(--light);
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--secondary);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-menu li {
            margin-bottom: 10px;
        }
        
        .nav-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            color: var(--light);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            background: var(--primary);
            color: white;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #34495e;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .coins {
            background: var(--warning);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        /* Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            color: #95a5a6;
        }
        
        /* Servers List */
        .servers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .server-card {
            background: #2c3e50;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s;
        }
        
        .server-card:hover {
            transform: translateY(-5px);
        }
        
        .server-header {
            padding: 15px;
            background: #34495e;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .server-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-online { background: var(--success); }
        .status-offline { background: var(--danger); }
        .status-installing { background: var(--warning); }
        
        .server-body {
            padding: 15px;
        }
        
        .server-specs {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .spec-item {
            text-align: center;
        }
        
        .spec-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .spec-label {
            font-size: 0.8rem;
            color: #95a5a6;
        }
        
        .server-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: opacity 0.3s;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--secondary);
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            background: #34495e;
            border: 1px solid #4a6278;
            border-radius: 5px;
            color: var(--light);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn-block {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                margin-left: 0;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid,
            .servers-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-server"></i>
            <span>Primeee Host</span>
        </div>
        
        <ul class="nav-menu">
            <li><a href="#" class="active" onclick="showSection('dashboard')">
                <i class="fas fa-home"></i> Dashboard
            </a></li>
            <li><a href="#" onclick="showSection('servers')">
                <i class="fas fa-server"></i> Mes Serveurs
            </a></li>
            <li><a href="#" onclick="showSection('create-server')">
                <i class="fas fa-plus-circle"></i> Cr√©er Serveur
            </a></li>
            <li><a href="#" onclick="showSection('coins')">
                <i class="fas fa-coins"></i> Mes Pi√®ces
            </a></li>
            <li><a href="#" onclick="showSection('referral')">
                <i class="fas fa-user-friends"></i> Parrainage
            </a></li>
            <li><a href="#" onclick="showSection('settings')">
                <i class="fas fa-cog"></i> Param√®tres
            </a></li>
            <li><a href="#" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> D√©connexion
            </a></li>
        </ul>
        
        <div style="margin-top: 30px; color: #95a5a6; font-size: 0.8rem;">
            <p>¬© 2024 Primeee Host</p>
            <p>Version 2.0</p>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <h1 id="page-title">Dashboard</h1>
            <div class="user-info">
                <div class="coins">
                    <i class="fas fa-coins"></i>
                    <span id="user-coins">1000</span> pi√®ces
                </div>
                <div id="user-greeting">Chargement...</div>
            </div>
        </div>
        
        <!-- Sections -->
        <div id="sections">
            <!-- Dashboard -->
            <section id="dashboard-section" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #3498db;">
                            <i class="fas fa-server"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-servers">0</h3>
                            <p>Serveurs actifs</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #2ecc71;">
                            <i class="fas fa-memory"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-ram">0 MB</h3>
                            <p>RAM totale</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #f39c12;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-uptime">0h</h3>
                            <p>Uptime total</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #9b59b6;">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-referrals">0</h3>
                            <p>Filleuls</p>
                        </div>
                    </div>
                </div>
                
                <h2 style="margin: 30px 0 15px;">Serveurs R√©cents</h2>
                <div id="recent-servers" class="servers-grid">
                    <!-- Charg√© dynamiquement -->
                </div>
                
                <div style="margin-top: 30px; padding: 20px; background: #2c3e50; border-radius: 10px;">
                    <h3><i class="fas fa-gift"></i> Bonus Quotidien</h3>
                    <p>Revenez chaque jour pour recevoir des pi√®ces gratuites !</p>
                    <button class="btn btn-success" onclick="claimDailyBonus()">
                        <i class="fas fa-gift"></i> Recevoir le bonus
                    </button>
                </div>
            </section>
            
            <!-- Mes Serveurs -->
            <section id="servers-section" class="section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Mes Serveurs</h2>
                    <button class="btn btn-primary" onclick="showSection('create-server')">
                        <i class="fas fa-plus"></i> Nouveau Serveur
                    </button>
                </div>
                
                <div id="servers-list" class="servers-grid">
                    <!-- Charg√© dynamiquement -->
                </div>
            </section>
            
            <!-- Cr√©er Serveur -->
            <section id="create-server-section" class="section" style="display: none;">
                <h2>Cr√©er un Nouveau Serveur</h2>
                <p style="margin-bottom: 20px; color: #95a5a6;">
                    Chaque 1000 pi√®ces = 1GB de RAM. Vous avez <span id="available-coins">1000</span> pi√®ces.
                </p>
                
                <div class="form-group">
                    <label>Nom du Serveur</label>
                    <input type="text" id="server-name" class="form-control" placeholder="Mon Bot Discord">
                </div>
                
                <div class="form-group">
                    <label>Type de Serveur</label>
                    <select id="server-type" class="form-control">
                        <option value="discord">ü§ñ Bot Discord</option>
                        <option value="whatsapp">üì± Bot WhatsApp</option>
                        <option value="telegram">üì≤ Bot Telegram</option>
                        <option value="website">üåê Site Web</option>
                        <option value="api">‚ö° API Backend</option>
                        <option value="game">üéÆ Serveur Jeu</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>RAM (MB) - Co√ªt: <span id="ram-cost">0</span> pi√®ces</label>
                    <input type="range" id="server-ram" min="512" max="8192" step="512" value="1024" 
                           class="form-control" oninput="updateRamCost()">
                    <div style="display: flex; justify-content: space-between;">
                        <span>512MB</span>
                        <span id="ram-value">1024</span> MB
                        <span>8192MB</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Stockage (MB)</label>
                    <input type="number" id="server-disk" class="form-control" value="5120" min="1024" max="51200">
                </div>
                
                <div class="form-group">
                    <label>Limite CPU (%)</label>
                    <input type="number" id="server-cpu" class="form-control" value="100" min="10" max="200">
                </div>
                
                <button class="btn btn-success btn-block" onclick="createServer()">
                    <i class="fas fa-plus-circle"></i> Cr√©er le Serveur
                </button>
            </section>
            
            <!-- Mes Pi√®ces -->
            <section id="coins-section" class="section" style="display: none;">
                <h2>√âconomie de Pi√®ces</h2>
                
                <div style="background: #2c3e50; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3><i class="fas fa-wallet"></i> Mon Portefeuille</h3>
                    <div style="font-size: 2rem; font-weight: bold; color: #f39c12; margin: 10px 0;">
                        <i class="fas fa-coins"></i> <span id="wallet-coins">1000</span> pi√®ces
                    </div>
                    <p>1GB RAM = 1000 pi√®ces</p>
                </div>
                
                <h3>Comment gagner des pi√®ces ?</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #34495e; padding: 15px; border-radius: 8px;">
                        <h4><i class="fas fa-user-plus"></i> Parrainage</h4>
                        <p>+100 pi√®ces par filleul</p>
                        <button class="btn btn-primary" onclick="showSection('referral')">
                            Voir mon lien
                        </button>
                    </div>
                    
                    <div style="background: #34495e; padding: 15px; border-radius: 8px;">
                        <h4><i class="fas fa-calendar-day"></i> Quotidien</h4>
                        <p>+10 pi√®ces chaque jour</p>
                        <button class="btn btn-success" onclick="claimDailyBonus()">
                            Recevoir
                        </button>
                    </div>
                    
                    <div style="background: #34495e; padding: 15px; border-radius: 8px;">
                        <h4><i class="fas fa-server"></i> Serveurs Actifs</h4>
                        <p>+1 pi√®ce par serveur/jour</p>
                    </div>
                    
                    <div style="background: #34495e; padding: 15px; border-radius: 8px;">
                        <h4><i class="fab fa-github"></i> GitHub</h4>
                        <p>+500 pi√®ces pour un repo</p>
                    </div>
                </div>
                
                <h3>Historique des Transactions</h3>
                <div id="transactions-list" style="margin-top: 15px;">
                    <!-- Charg√© dynamiquement -->
                </div>
            </section>
            
            <!-- Parrainage -->
            <section id="referral-section" class="section" style="display: none;">
                <h2>Syst√®me de Parrainage</h2>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                            padding: 30px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: white;"><i class="fas fa-user-friends"></i> Gagnez 100 pi√®ces par ami !</h3>
                    <p style="color: rgba(255,255,255,0.9); margin: 10px 0;">
                        Partagez votre lien et recevez 100 pi√®ces pour chaque ami qui s'inscrit.
                    </p>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h4 style="color: white;">Votre lien de parrainage :</h4>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <input type="text" id="referral-link" class="form-control" readonly 
                                   style="background: white; color: #333;">
                            <button class="btn btn-success" onclick="copyReferralLink()">
                                <i class="fas fa-copy"></i> Copier
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: #2c3e50; padding: 20px; border-radius: 10px;">
                        <h4><i class="fas fa-trophy"></i> Vos Statistiques</h4>
                        <div style="margin-top: 15px;">
                            <p>Filleuls totaux : <strong id="total-referrals-count">0</strong></p>
                            <p>Pi√®ces gagn√©es : <strong id="referral-earnings">0</strong></p>
                        </div>
                    </div>
                    
                    <div style="background: #2c3e50; padding: 20px; border-radius: 10px;">
                        <h4><i class="fas fa-code"></i> Code de parrainage</h4>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #3498db; margin: 10px 0;">
                            <span id="referral-code">PRIME123</span>
                        </div>
                        <p>Donnez ce code √† vos amis lors de l'inscription</p>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;">Vos Filleuls</h3>
                <div id="referrals-list" style="margin-top: 15px;">
                    <!-- Charg√© dynamiquement -->
                </div>
            </section>
            
            <!-- Param√®tres -->
            <section id="settings-section" class="section" style="display: none;">
                <h2>Param√®tres du Compte</h2>
                
                <div style="max-width: 500px;">
                    <div class="form-group">
                        <label>Nom d'utilisateur</label>
                        <input type="text" id="settings-username" class="form-control" disabled>
                    </div>
                    
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="settings-email" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Nouveau mot de passe (laisser vide pour ne pas changer)</label>
                        <input type="password" id="settings-password" class="form-control">
                    </div>
                    
                    <button class="btn btn-primary" onclick="updateSettings()">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                </div>
            </section>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="server-control-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Contr√¥le Serveur</h3>
                <button class="close-modal" onclick="closeModal('server-control-modal')">&times;</button>
            </div>
            <div id="modal-body">
                <!-- Contenu dynamique -->
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script>
        // Variables globales
        let currentUser = null;
        let currentToken = null;
        
        // V√©rifier la connexion au chargement
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('primeee_token');
            const user = localStorage.getItem('primeee_user');
            
            if (!token || !user) {
                window.location.href = 'login.html';
                return;
            }
            
            currentToken = token;
            currentUser = JSON.parse(user);
            
            // Mettre √† jour l'interface
            updateUserInfo();
            loadDashboard();
            
            // Charger les serveurs
            loadServers();
            loadTransactions();
            loadReferrals();
        });
        
        // Mettre √† jour les infos utilisateur
        function updateUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('user-coins').textContent = currentUser.coins || 0;
            document.getElementById('user-greeting').textContent = `Bonjour, ${currentUser.username}`;
            document.getElementById('available-coins').textContent = currentUser.coins || 0;
            document.getElementById('wallet-coins').textContent = currentUser.coins || 0;
            document.getElementById('settings-username').value = currentUser.username;
            document.getElementById('settings-email').value = currentUser.email;
            
            // Lien de parrainage
            if (currentUser.referral_code) {
                const link = `${window.location.origin}/register.html?ref=${currentUser.referral_code}`;
                document.getElementById('referral-link').value = link;
                document.getElementById('referral-code').textContent = currentUser.referral_code;
            }
        }
        
        // Navigation entre sections
        function showSection(sectionId) {
            // Cacher toutes les sections
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            
            // D√©sactiver tous les liens
            document.querySelectorAll('.nav-menu a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Afficher la section demand√©e
            const section = document.getElementById(`${sectionId}-section`);
            if (section) {
                section.style.display = 'block';
                
                // Activer le lien correspondant
                const link = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
                if (link) link.classList.add('active');
                
                // Mettre √† jour le titre
                const titles = {
                    'dashboard': 'Dashboard',
                    'servers': 'Mes Serveurs',
                    'create-server': 'Cr√©er un Serveur',
                    'coins': 'Mes Pi√®ces',
                    'referral': 'Parrainage',
                    'settings': 'Param√®tres'
                };
                
                document.getElementById('page-title').textContent = titles[sectionId] || 'Dashboard';
                
                // Actions sp√©cifiques
                if (sectionId === 'dashboard') {
                    loadDashboard();
                } else if (sectionId === 'servers') {
                    loadServers();
                } else if (sectionId === 'coins') {
                    loadTransactions();
                } else if (sectionId === 'referral') {
                    loadReferrals();
                }
            }
            
            return false;
        }
        
        // Charger le dashboard
        async function loadDashboard() {
            try {
                const response = await fetch('/api/user/profile', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Mettre √† jour les stats
                    document.getElementById('total-servers').textContent = data.user.server_count || 0;
                    document.getElementById('total-ram').textContent = `${data.user.total_ram || 0} MB`;
                    document.getElementById('total-uptime').textContent = `${Math.floor((data.user.total_uptime || 0) / 3600)}h`;
                    document.getElementById('total-referrals').textContent = data.user.total_invites || 0;
                    
                    // Mettre √† jour les pi√®ces
                    if (data.user.coins !== undefined) {
                        currentUser.coins = data.user.coins;
                        localStorage.setItem('primeee_user', JSON.stringify(currentUser));
                        updateUserInfo();
                    }
                }
            } catch (error) {
                console.error('Erreur chargement dashboard:', error);
            }
        }
        
        // Charger les serveurs
        async function loadServers() {
            try {
                const response = await fetch('/api/servers', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('servers-list');
                    const recentContainer = document.getElementById('recent-servers');
                    
                    if (!container || !recentContainer) return;
                    
                    container.innerHTML = '';
                    recentContainer.innerHTML = '';
                    
                    if (data.servers.length === 0) {
                        container.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                                <i class="fas fa-server" style="font-size: 3rem; color: #7f8c8d;"></i>
                                <h3 style="margin: 20px 0 10px;">Aucun serveur</h3>
                                <p>Cr√©ez votre premier serveur pour commencer !</p>
                                <button class="btn btn-primary" onclick="showSection('create-server')">
                                    <i class="fas fa-plus"></i> Cr√©er un serveur
                                </button>
                            </div>
                        `;
                        
                        recentContainer.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #95a5a6;">
                                Aucun serveur r√©cent
                            </div>
                        `;
                        return;
                    }
                    
                    // Afficher tous les serveurs
                    data.servers.forEach(server => {
                        container.innerHTML += createServerCard(server);
                    });
                    
                    // Afficher les 4 serveurs les plus r√©cents dans le dashboard
                    const recentServers = data.servers.slice(0, 4);
                    recentServers.forEach(server => {
                        recentContainer.innerHTML += createServerCard(server);
                    });
                }
            } catch (error) {
                console.error('Erreur chargement serveurs:', error);
            }
        }
        
        // Cr√©er une carte serveur
        function createServerCard(server) {
            const statusClass = {
                'running': 'status-online',
                'stopped': 'status-offline',
                'installing': 'status-installing',
                'error': 'status-offline'
            }[server.status] || 'status-offline';
            
            const statusText = {
                'running': 'EN LIGNE',
                'stopped': 'ARR√äT√â',
                'installing': 'INSTALLATION',
                'error': 'ERREUR'
            }[server.status] || 'INCONNU';
            
            const typeIcons = {
                'discord': 'fab fa-discord',
                'whatsapp': 'fab fa-whatsapp',
                'telegram': 'fab fa-telegram',
                'website': 'fas fa-globe',
                'api': 'fas fa-code',
                'game': 'fas fa-gamepad'
            };
            
            return `
                <div class="server-card">
                    <div class="server-header">
                        <div>
                            <h3 style="display: flex; align-items: center; gap: 10px;">
                                <i class="${typeIcons[server.type] || 'fas fa-server'}"></i>
                                ${server.name}
                            </h3>
                        </div>
                        <span class="server-status ${statusClass}">${statusText}</span>
                    </div>
                    
                    <div class="server-body">
                        <div class="server-specs">
                            <div class="spec-item">
                                <div class="spec-value">${server.allocated_ram}MB</div>
                                <div class="spec-label">RAM</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-value">${server.allocated_disk}MB</div>
                                <div class="spec-label">DISK</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-value">${server.cpu_limit}%</div>
                                <div class="spec-label">CPU</div>
                            </div>
                        </div>
                        
                        <div class="server-actions">
                            ${server.status === 'running' ? `
                                <button class="btn btn-danger" onclick="controlServer(${server.id}, 'stop')">
                                    <i class="fas fa-stop"></i> Stop
                                </button>
                                <button class="btn btn-warning" onclick="controlServer(${server.id}, 'restart')">
                                    <i class="fas fa-redo"></i> Restart
                                </button>
                            ` : `
                                <button class="btn btn-success" onclick="controlServer(${server.id}, 'start')">
                                    <i class="fas fa-play"></i> Start
                                </button>
                            `}
                            
                            <button class="btn btn-primary" onclick="openServerControl(${server.id})">
                                <i class="fas fa-cog"></i> G√©rer
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Contr√¥ler un serveur
        async function controlServer(serverId, action) {
            if (!confirm(`√ätes-vous s√ªr de vouloir ${action} ce serveur ?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/servers/${serverId}/control`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`Serveur ${action} avec succ√®s !`);
                    loadServers();
                    loadDashboard();
                } else {
                    alert(data.error || 'Erreur');
                }
            } catch (error) {
                console.error('Erreur contr√¥le serveur:', error);
                alert('Erreur de connexion');
            }
        }
        
        // Ouvrir le modal de contr√¥le serveur
        function openServerControl(serverId) {
            // Pour l'instant, simple redirection vers le panel de contr√¥le
            // TODO: Impl√©menter le panel complet
            alert(`Panel de contr√¥le pour le serveur ${serverId} - √Ä impl√©menter`);
        }
        
        // Calculer le co√ªt de la RAM
        function updateRamCost() {
            const ram = document.getElementById('server-ram').value;
            const cost = (ram / 1024) * 1000;
            
            document.getElementById('ram-value').textContent = ram;
            document.getElementById('ram-cost').textContent = cost;
            
            // V√©rifier si l'utilisateur a assez de pi√®ces
            const canAfford = currentUser.coins >= cost;
            document.getElementById('server-ram').style.borderColor = canAfford ? '' : '#e74c3c';
        }
        
        // Cr√©er un serveur
        async function createServer() {
            const name = document.getElementById('server-name').value.trim();
            const type = document.getElementById('server-type').value;
            const ram = parseInt(document.getElementById('server-ram').value);
            const disk = parseInt(document.getElementById('server-disk').value);
            const cpu = parseInt(document.getElementById('server-cpu').value);
            
            if (!name) {
                alert('Veuillez donner un nom √† votre serveur');
                return;
            }
            
            const cost = (ram / 1024) * 1000;
            if (currentUser.coins < cost) {
                alert(`Pi√®ces insuffisantes ! Co√ªt: ${cost} pi√®ces, Vous avez: ${currentUser.coins} pi√®ces`);
                return;
            }
            
            if (!confirm(`Cr√©er le serveur "${name}" pour ${cost} pi√®ces ?`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/servers/create', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        type,
                        ram,
                        disk,
                        cpu
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(data.message);
                    
                    // Mettre √† jour les pi√®ces
                    currentUser.coins -= cost;
                    localStorage.setItem('primeee_user', JSON.stringify(currentUser));
                    updateUserInfo();
                    
                    // Recharger les serveurs
                    loadServers();
                    loadDashboard();
                    
                    // Retourner √† la liste des serveurs
                    showSection('servers');
                } else {
                    alert(data.error || 'Erreur cr√©ation serveur');
                }
            } catch (error) {
                console.error('Erreur cr√©ation serveur:', error);
                alert('Erreur de connexion');
            }
        }
        
        // R√©clamer le bonus quotidien
        async function claimDailyBonus() {
            try {
                const response = await fetch('/api/coins/daily', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(data.message);
                    
                    // Mettre √† jour les pi√®ces
                    currentUser.coins += data.coins;
                    localStorage.setItem('primeee_user', JSON.stringify(currentUser));
                    updateUserInfo();
                    
                    // Recharger les transactions
                    loadTransactions();
                } else {
                    alert(data.error || 'Erreur');
                }
            } catch (error) {
                console.error('Erreur bonus quotidien:', error);
                alert('Erreur de connexion');
            }
        }
        
        // Charger les transactions
        async function loadTransactions() {
            try {
                const response = await fetch('/api/user/transactions', {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('transactions-list');
                    if (!container) return;
                    
                    container.innerHTML = '';
                    
                    if (data.transactions.length === 0) {
                        container.innerHTML = '<p style="color: #95a5a6;">Aucune transaction</p>';
                        return;
                    }
                    
                    data.transactions.forEach(transaction => {
                        const amount = transaction.amount;
                        const isPositive = amount > 0;
                        
                        container.innerHTML += `
                            <div style="display: flex; justify-content: space-between; align-items: center;
                                        padding: 15px; background: #34495e; margin-bottom: 10px; border-radius: 5px;">
                                <div>
                                    <div style="font-weight: bold;">${transaction.description}</div>
                                    <div style="font-size: 0.8rem; color: #95a5a6;">
                                        ${new Date(transaction.created_at).toLocaleString()}
                                    </div>
                                </div>
                                <div style="color: ${isPositive ? '#2ecc71' : '#e74c3c'}; font-weight: bold;">
                                    ${isPositive ? '+' : ''}${amount} pi√®ces
                                </div>
                            </div>
                        `;
                    });
                }
            } catch (error) {
                console.error('Erreur chargement transactions:', error);
            }
        }
        
        // Charger les parrainages
        async function loadReferrals() {
            try {
                // Pour l'instant, utiliser les donn√©es de l'utilisateur
                // TODO: API pour r√©cup√©rer la liste des filleuls
                
                document.getElementById('total-referrals-count').textContent = currentUser.total_invites || 0;
                document.getElementById('referral-earnings').textContent = (currentUser.total_invites || 0) * 100;
                
                const container = document.getElementById('referrals-list');
                if (container) {
                    container.innerHTML = `
                        <div style="color: #95a5a6; text-align: center; padding: 20px;">
                            ${currentUser.total_invites > 0 
                                ? `${currentUser.total_invites} filleul(s) - Total: ${currentUser.total_invites * 100} pi√®ces`
                                : 'Aucun filleul pour le moment'}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Erreur chargement parrainages:', error);
            }
        }
        
        // Copier le lien de parrainage
        function copyReferralLink() {
            const input = document.getElementById('referral-link');
            input.select();
            document.execCommand('copy');
            alert('Lien copi√© !');
        }
        
        // Mettre √† jour les param√®tres
        async function updateSettings() {
            const email = document.getElementById('settings-email').value;
            const password = document.getElementById('settings-password').value;
            
            if (!email) {
                alert('Email requis');
                return;
            }
            
            try {
                // TODO: API pour mettre √† jour les param√®tres
                alert('Fonctionnalit√© en d√©veloppement');
            } catch (error) {
                console.error('Erreur mise √† jour param√®tres:', error);
                alert('Erreur');
            }
        }
        
        // G√©rer les modals
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // D√©connexion
        function logout() {
            localStorage.removeItem('primeee_token');
            localStorage.removeItem('primeee_user');
            window.location.href = 'login.html';
        }
        
        // Initialiser le co√ªt de la RAM
        updateRamCost();
    </script>
</body>
</html>
